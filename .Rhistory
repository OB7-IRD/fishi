as.data.frame(avdth_prcwellsample_year_fleet_ocean_final[, 6])))
rbind(as.data.frame(avdth_prcwellsample_year_fleet_ocean_final[, 5]),
as.data.frame(avdth_prcwellsample_year_fleet_ocean_final[, 6]))
tmp <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled") %>%
dplyr::rename(totwell = wellsample) %>%
rbind(avdth_prcwellsample_year_fleet_ocean_final[, c(1:4, 6)])
avdth_prcwellsample_year_fleet_ocean_final
tmp <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5]
tmp
tmp <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled") %>%
dplyr::rename(nbwell = wellsample) %>%
tmp <- rbind(avdth_prcwellsample_year_fleet_ocean_final[, 1:4],
avdth_prcwellsample_year_fleet_ocean_final[, 1:4]) %>%
cbind(rbind(as.data.frame(avdth_prcwellsample_year_fleet_ocean_final[, 5]),
as.data.frame(avdth_prcwellsample_year_fleet_ocean_final[, 6])))
tmp <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled")
tmp
tmp <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled") %>%
dplyr::rename(wellsample = nbwell)
tmp <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled") %>%
dplyr::rename(nbwell = wellsample)
tmp
avdth_prcwellsample_year_fleet_ocean_final
# Data design ----
avdth_prcwellsample_year_fleet_ocean_final <- avdth_prcwellsample_year_fleet_ocean[[1]] %>%
dplyr::full_join(avdth_prcwellsample_year_fleet_ocean[[2]], by = c("fleet", "year_wellsample", "month_wellsample", "ocean")) %>%
dplyr::mutate(wellsample = ifelse(is.na(wellsample),
0,
wellsample),
totwell = ifelse(is.na(totwell),
0,
totwell)) %>%
mutate(wellnotsample = totwell - wellsample)
# Data design ----
avdth_prcwellsample_year_fleet_ocean_final <- avdth_prcwellsample_year_fleet_ocean[[1]] %>%
dplyr::full_join(avdth_prcwellsample_year_fleet_ocean[[2]], by = c("fleet", "year_wellsample", "month_wellsample", "ocean")) %>%
dplyr::mutate(wellsample = ifelse(is.na(wellsample),
0,
wellsample),
totwell = ifelse(is.na(totwell),
0,
totwell)) %>%
dplyr::mutate(wellnotsample = totwell - wellsample)
avdth_prcwellsample_year_fleet_ocean_final
tmp <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled") %>%
dplyr::rename(nbwell = wellsample) %>%
inner_join(avdth_prcwellsample_year_fleet_ocean_final[, c(1:4, 7)] %>%
dplyr::mutate(type = "well_not_sampled") %>%
dplyr::rename(nbwell = wellnotsample))
tmp <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled") %>%
dplyr::rename(nbwell = wellsample) %>%
dplyr::inner_join(avdth_prcwellsample_year_fleet_ocean_final[, c(1:4, 7)] %>%
dplyr::mutate(type = "well_not_sampled") %>%
dplyr::rename(nbwell = wellnotsample))
tmp
tmp <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled") %>%
dplyr::rename(nbwell = wellsample) %>%
rbind(avdth_prcwellsample_year_fleet_ocean_final[, c(1:4, 7)] %>%
dplyr::mutate(type = "well_not_sampled") %>%
dplyr::rename(nbwell = wellnotsample))
tmp
tmp
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 1) {
ocean_name <- "Atlantic Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 2) {
ocean_name <- "Indian Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 3) {
ocean_name <- "West Pacific Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 4) {
ocean_name <- "East Pacific Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 5) {
ocean_name <- "Pacific Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 6) {
ocean_name <- "Undetermined"
}
}
}
}
}
}
avdth_prcwellsample_year_fleet_ocean_final <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled") %>%
dplyr::rename(nbwell = wellsample) %>%
rbind(avdth_prcwellsample_year_fleet_ocean_final[, c(1:4, 7)] %>%
dplyr::mutate(type = "well_not_sampled") %>%
dplyr::rename(nbwell = wellnotsample))
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 1) {
ocean_name <- "Atlantic Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 2) {
ocean_name <- "Indian Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 3) {
ocean_name <- "West Pacific Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 4) {
ocean_name <- "East Pacific Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 5) {
ocean_name <- "Pacific Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 6) {
ocean_name <- "Undetermined"
}
}
}
}
}
}
ocean_name
# Graphic design ----
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity")
# Graphic design ----
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity")
tmp
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity",
position = "fill")
tmp
avdth_prcwellsample_year_fleet_ocean_final
22+39
22*100/61
39*100/61
percentage = F
percentage == F | percentage = FALSE
percentage == F | percentage == FALSE
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample)))
tmp
fleet_name
paste0("Number of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Number of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
} else {
tmp
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Number of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")"))
tmp
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Number of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
ggplot2::xlab("Months") +
ggplot2::ylab("Number of well")
tmp
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Number of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
ggplot2::xlab("Months") +
ggplot2::ylab("Number of wells")
tmp
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Number of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
ggplot2::xlab("Months") +
ggplot2::ylab("Number of wells") +
ggplot2::labs(fill = NULL)
tmp
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity",
position = "fill") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Percentage of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
ggplot2::xlab("Months") +
ggplot2::ylab("Percentage of wells") +
ggplot2::labs(fill = NULL)
tmp
?scale_y_continuous
install.packages("Scale")
install.packages("scales")
install.packages("scales")
install.packages("scales")
config_file <- configuration_file(new_configtype = FALSE,
path_configtype = "D:\\IRD\\5-Projets_&_themes\\12-Indicateurs\\2-Data\\configfile_indicators.csv")
# Database connections ----
t3_connection <- db_connection(db_user = config_file[["t3plus_user"]],
db_password = config_file[["t3plus_password"]],
db_dbname = config_file[["t3plus_dbname"]],
db_host = config_file[["t3plus_host"]],
db_port = config_file[["t3plus_port"]])
avdth_connection <- access_dbconnection(jdbc_access_driverclass = config_file[["jdbc_access_driverclass"]],
jdbc_access_driver_loc = config_file[["jdbc_access_driver_loc"]],
access_db_loc = config_file[["access_db_loc"]])
library(fishi)
library(furdeb)
# Configuration file ----
config_file <- configuration_file(new_configtype = FALSE,
path_configtype = "D:\\IRD\\5-Projets_&_themes\\12-Indicateurs\\2-Data\\configfile_indicators.csv")
# Database connections ----
t3_connection <- db_connection(db_user = config_file[["t3plus_user"]],
db_password = config_file[["t3plus_password"]],
db_dbname = config_file[["t3plus_dbname"]],
db_host = config_file[["t3plus_host"]],
db_port = config_file[["t3plus_port"]])
avdth_connection <- access_dbconnection(jdbc_access_driverclass = config_file[["jdbc_access_driverclass"]],
jdbc_access_driver_loc = config_file[["jdbc_access_driver_loc"]],
access_db_loc = config_file[["access_db_loc"]])
avdth_con = avdth_connection
year = 2017
fleet = c(1, 41)
ocean = 1
fleet_name = "french fleet"
percentage = F
# Query importation ----
avdth_prcwellsample_year_fleet_ocean_query <- vector('list', 2)
names(avdth_prcwellsample_year_fleet_ocean_query) <- c("avdth_wellsample_year_fleet_ocean",
"avdth_totwell_year_fleet_ocean")
for (i in 1:length(avdth_prcwellsample_year_fleet_ocean_query)) {
avdth_prcwellsample_year_fleet_ocean_query[[i]] <- paste(readLines(con = paste0("D:\\IRD\\4-Developpement\\1-R\\6-Packages\\fishi\\inst\\sql\\",
names(avdth_prcwellsample_year_fleet_ocean_query)[[i]],
".sql")),
collapse = "\n")
}
# avdth_prcwellsample_year_fleet_ocean_query <- paste(readLines(con = system.file("sql",
#                                                                                     "avdth_prcwellsample_year_fleet_ocean.sql",
#                                                                                     package = "fishi")),
#                                                         collapse = "\n")
# Value(s) interpolation(s) ----
for (i in 1:length(avdth_prcwellsample_year_fleet_ocean_query)) {
avdth_prcwellsample_year_fleet_ocean_query[[i]] <- furdeb::sql_inset(db_type = "access",
replacement = year,
pattern = "year_interpolate",
query = avdth_prcwellsample_year_fleet_ocean_query[[i]])
avdth_prcwellsample_year_fleet_ocean_query[[i]] <- furdeb::sql_inset(db_type = "access",
replacement = fleet,
pattern = "fleet_interpolate",
query = avdth_prcwellsample_year_fleet_ocean_query[[i]])
avdth_prcwellsample_year_fleet_ocean_query[[i]] <- furdeb::sql_inset(db_type = "access",
replacement = ocean,
pattern = "ocean_interpolate",
query = avdth_prcwellsample_year_fleet_ocean_query[[i]])
}
# Data importation ----
avdth_prcwellsample_year_fleet_ocean <- vector('list', 2)
names(avdth_prcwellsample_year_fleet_ocean) <-names(avdth_prcwellsample_year_fleet_ocean_query)
for (i in 1:length(avdth_prcwellsample_year_fleet_ocean)) {
avdth_prcwellsample_year_fleet_ocean[[i]] <- DBI::dbGetQuery(avdth_con,
avdth_prcwellsample_year_fleet_ocean_query[[i]])
}
# Data design ----
avdth_prcwellsample_year_fleet_ocean_final <- avdth_prcwellsample_year_fleet_ocean[[1]] %>%
dplyr::full_join(avdth_prcwellsample_year_fleet_ocean[[2]], by = c("fleet", "year_wellsample", "month_wellsample", "ocean")) %>%
dplyr::mutate(wellsample = ifelse(is.na(wellsample),
0,
wellsample),
totwell = ifelse(is.na(totwell),
0,
totwell)) %>%
dplyr::mutate(wellnotsample = totwell - wellsample)
avdth_prcwellsample_year_fleet_ocean_final <- avdth_prcwellsample_year_fleet_ocean_final[, 1:5] %>%
dplyr::mutate(type = "well_sampled") %>%
dplyr::rename(nbwell = wellsample) %>%
rbind(avdth_prcwellsample_year_fleet_ocean_final[, c(1:4, 7)] %>%
dplyr::mutate(type = "well_not_sampled") %>%
dplyr::rename(nbwell = wellnotsample))
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 1) {
ocean_name <- "Atlantic Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 2) {
ocean_name <- "Indian Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 3) {
ocean_name <- "West Pacific Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 4) {
ocean_name <- "East Pacific Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 5) {
ocean_name <- "Pacific Ocean"
} else {
if (unique(avdth_prcwellsample_year_fleet_ocean_final$ocean) == 6) {
ocean_name <- "Undetermined"
}
}
}
}
}
}
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity",
position = "fill") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Percentage of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
ggplot2::xlab("Months") +
ggplot2::ylab("Percentage of wells") +
ggplot2::labs(fill = NULL)
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity",
position = "fill") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Percentage of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
ggplot2::xlab("Months") +
ggplot2::ylab("Percentage of wells") +
ggplot2::labs(fill = NULL)
install.packages(c("blob", "hms"))
install.packages("scales")
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity",
position = "fill") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Percentage of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
ggplot2::xlab("Months") +
ggplot2::ylab("Percentage of wells") +
ggplot2::labs(fill = NULL)
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity",
position = "fill") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::scale_y_continuous(labels = scales::percent) +
ggplot2::ggtitle(label = paste0("Percentage of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
ggplot2::xlab("Months") +
ggplot2::ylab("Percentage of wells") +
ggplot2::labs(fill = NULL)
tmp
tmp <- ggplot2::ggplot(avdth_prcwellsample_year_fleet_ocean_final,
ggplot2::aes(fill = type,
y = nbwell,
x = month_wellsample)) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::scale_x_discrete(limits = c(min(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample):max(avdth_prcwellsample_year_fleet_ocean_final$month_wellsample))) +
ggplot2::ggtitle(label = paste0("Number of well sampled or not for the ",
fleet_name,
" in the ",
ocean_name,
" (",
year,
")")) +
ggplot2::xlab("Months") +
ggplot2::ylab("Number of wells") +
ggplot2::labs(fill = NULL)
tmp
is.logical()
?is.logical
percentage
percentage %in% c("F", "FALSE", "False", "false")
is.logical(percentage)
missing(percentage)
stop(paste0("Missing argument \"percentage\" or not a logical object.",
"\n",
"Please correct it before running the function."))
paste0(names(avdth_prcwellsample_year_fleet_ocean_query)[[i]],
".sql"))
names(avdth_prcwellsample_year_fleet_ocean_query)[[i]]
paste(readLines(con = system.file("sql",
paste0(names(avdth_prcwellsample_year_fleet_ocean_query)[[i]],
".sql"),
package = "fishi")),
collapse = "\n")
library(fishi)
# avdth_prcwellsample_year_fleet_ocean
tmp5 <- avdth_prcwellsample_year_fleet_ocean(avdth_con = avdth_connection,
year = 2017,
fleet = c(1, 41),
ocean = 1,
fleet_name = "french fleet",
percentage = T)
# avdth_prcwellsample_year_fleet_ocean
tmp5 <- avdth_wellsample_year_fleet_ocean(avdth_con = avdth_connection,
year = 2017,
fleet = c(1, 41),
ocean = 1,
fleet_name = "french fleet",
percentage = T)
config_file <- configuration_file(new_configtype = FALSE,
path_configtype = "D:\\IRD\\5-Projets_&_themes\\12-Indicateurs\\2-Data\\configfile_indicators.csv")
# Database connections ----
t3_connection <- db_connection(db_user = config_file[["t3plus_user"]],
db_password = config_file[["t3plus_password"]],
db_dbname = config_file[["t3plus_dbname"]],
db_host = config_file[["t3plus_host"]],
db_port = config_file[["t3plus_port"]])
avdth_connection <- access_dbconnection(jdbc_access_driverclass = config_file[["jdbc_access_driverclass"]],
jdbc_access_driver_loc = config_file[["jdbc_access_driver_loc"]],
access_db_loc = config_file[["access_db_loc"]])
# avdth_prcwellsample_year_fleet_ocean
tmp5 <- avdth_wellsample_year_fleet_ocean(avdth_con = avdth_connection,
year = 2017,
fleet = c(1, 41),
ocean = 1,
fleet_name = "french fleet",
percentage = T)
tmp5
